<form

  class="form-horizontal"
  autocomplete="off"
  #editPatientForm="ngForm"
  (ngSubmit)="save()">
   
  <!-- ===== Modal Header ===== -->
  <abp-modal-header
    [title]="'Edit Patient' | localize"
    (onCloseClick)="bsModalRef.hide()">
  </abp-modal-header>

  <div class="modal-body">

    <!-- Patient Code -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Patient Code</label>
      <div class="col-md-9">
        <input type="text"
          class="form-control"
          name="patientCode"
          required
          minlength="3"
          maxlength="20"
          [(ngModel)]="patient.patientCode"
          #codeModel="ngModel" />

        <abp-validation-summary [control]="codeModel"></abp-validation-summary>
      </div>
    </div>

    <!-- First Name -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">First Name</label>
      <div class="col-md-9">
        <input type="text"
          class="form-control"
          name="firstName"
          required
          minlength="2"
          maxlength="50"
          pattern="^[A-Z].*"
          [(ngModel)]="patient.firstName"
          #fnameModel="ngModel" />

        <abp-validation-summary [control]="fnameModel"></abp-validation-summary>

        <small class="text-danger"
          *ngIf="fnameModel.touched && fnameModel.errors?.['pattern']">
          First letter capital hona chahiye
        </small>
      </div>
    </div>

    <!-- Last Name -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Last Name</label>
      <div class="col-md-9">
        <input type="text"
          class="form-control"
          name="lastName"
          required
          minlength="2"
          maxlength="50"
          [(ngModel)]="patient.lastName"
          #lnameModel="ngModel" />

        <abp-validation-summary [control]="lnameModel"></abp-validation-summary>
      </div>
    </div>

    <!-- ⭐ DATE OF BIRTH FIX -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Date Of Birth</label>
      <div class="col-md-9">
        <input type="date"
          class="form-control"
          name="dateOfBirth"
          required
          [(ngModel)]="dateOfBirthString"
          #dobModel="ngModel" />

        <abp-validation-summary [control]="dobModel"></abp-validation-summary>
      </div>
    </div>

    <!-- Gender -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Gender</label>
      <div class="col-md-9">
        <select class="form-control"
          name="gender"
          required
          [(ngModel)]="patient.gender"
          #genderModel="ngModel">

          <option value="">-- Select Gender --</option>
          <option [value]="5">Male</option>
          <option [value]="10">Female</option>
          <option [value]="15">Other</option>
        </select>

        <abp-validation-summary [control]="genderModel"></abp-validation-summary>
      </div>
    </div>

    <!-- Phone -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Phone Number</label>
      <div class="col-md-9">
        <input type="text"
          class="form-control"
          name="phoneNumber"
          required
          pattern="^[0-9]{10}$"
          [(ngModel)]="patient.phoneNumber"
          #phoneModel="ngModel" />

        <abp-validation-summary [control]="phoneModel"></abp-validation-summary>

        <small class="text-danger"
          *ngIf="phoneModel.touched && phoneModel.errors?.['pattern']">
          10 digit mobile number required
        </small>
      </div>
    </div>

    <!-- Email -->
    <div class="form-group row required">
      <label class="col-md-3 col-form-label">Email</label>
      <div class="col-md-9">
        <input type="email"
          class="form-control"
          name="email"
          required
          [(ngModel)]="patient.email"
          #emailModel="ngModel" />

        <small class="text-danger"
          *ngIf="emailModel?.touched && emailModel?.errors?.['required']">
          Email is required
        </small>

        <small class="text-danger"
          *ngIf="emailModel?.touched && emailModel?.errors?.['email']">
          Invalid email format
        </small>
      </div>
    </div>

    <!-- Address -->
    <div class="form-group row">
      <label class="col-md-3 col-form-label">Address</label>
      <div class="col-md-9">
        <textarea class="form-control"
          name="address"
          rows="3"
          [(ngModel)]="patient.address">
        </textarea>
      </div>
    </div>

    <!-- ⭐ PHOTO UPLOAD -->
    <div class="form-group row">
      <label class="col-md-3 col-form-label">Photo</label>
      <div class="col-md-9">
        <input type="file"
          class="form-control"
          (change)="onFileSelected($event)"
          accept="image/*" />

        <small class="text-muted">
          Upload new photo (jpg, png, max 2MB)
        </small>

        <!-- Existing Photo -->
        <div *ngIf="existingPhotoPath" class="mt-2">
          <label>Existing Photo:</label><br />
          <img [src]="existingPhotoPath"
            alt="Patient Photo"
            class="img-thumbnail"
            width="120" />
        </div>
      </div>
    </div>

  </div>

  <!-- ===== Modal Footer ===== -->
  <abp-modal-footer
       (onSaveClick)="save()"
    (onCancelClick)="bsModalRef.hide()">
  </abp-modal-footer>

</form>
